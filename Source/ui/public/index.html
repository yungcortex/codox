<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Codox</title>

  <style>
    /* CRITICAL: WebView constraints */
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    *, *::before, *::after {
      box-sizing: border-box;
    }

    body {
      /* Native application feel */
      user-select: none;
      -webkit-user-select: none;
      cursor: default;
      overflow: hidden;

      /* Center the plugin frame */
      display: flex;
      align-items: center;
      justify-content: center;
      background: #000;
      font-family: Arial, sans-serif;
    }

    /* Fixed-size frame matching plugin spec */
    .plugin-frame {
      width: 1200px;
      height: 800px;
      border: 2px solid #444;
      box-shadow: 0 10px 40px rgba(0,0,0,0.5);
      overflow: hidden;
      position: relative;
      background: #1a1a1a;
    }

    /* Main container */
    .container {
      width: 100%;
      height: 100%;
      position: relative;
      color: #ffffff;
    }

    /* Section styling */
    .section {
      position: absolute;
      border: 1px solid #333;
      border-radius: 4px;
      padding: 8px;
    }

    .section-label {
      position: absolute;
      font-size: 11px;
      font-weight: bold;
      color: #999;
      letter-spacing: 1px;
      text-transform: uppercase;
    }

    /* Header section */
    .header {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 45px;
      background: linear-gradient(180deg, #2a2a2a 0%, #1a1a1a 100%);
      border-bottom: 1px solid #333;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    /* Oscillator sections */
    .osc-section {
      background: rgba(78, 205, 196, 0.05);
      border-color: rgba(78, 205, 196, 0.2);
    }

    .osc-a {
      left: 10px;
      top: 50px;
      width: 340px;
      height: 225px;
    }

    .osc-b {
      left: 360px;
      top: 50px;
      width: 340px;
      height: 225px;
    }

    /* Sub + Noise section */
    .sub-noise {
      left: 710px;
      top: 50px;
      width: 190px;
      height: 225px;
      background: rgba(255, 140, 66, 0.05);
      border-color: rgba(255, 140, 66, 0.2);
    }

    /* Filter section */
    .filter-section {
      left: 910px;
      top: 50px;
      width: 280px;
      height: 225px;
      background: rgba(255, 140, 66, 0.05);
      border-color: rgba(255, 140, 66, 0.2);
    }

    /* Envelope sections */
    .amp-env {
      left: 10px;
      top: 290px;
      width: 340px;
      height: 190px;
      background: rgba(78, 205, 196, 0.05);
      border-color: rgba(78, 205, 196, 0.2);
    }

    .filt-env {
      left: 360px;
      top: 290px;
      width: 340px;
      height: 190px;
      background: rgba(255, 140, 66, 0.05);
      border-color: rgba(255, 140, 66, 0.2);
    }

    /* LFO section */
    .lfo-section {
      left: 710px;
      top: 290px;
      width: 480px;
      height: 190px;
      background: rgba(78, 205, 196, 0.05);
      border-color: rgba(78, 205, 196, 0.2);
    }

    /* Macros + Voice section */
    .macros-voice {
      left: 710px;
      top: 490px;
      width: 480px;
      height: 190px;
      background: rgba(255, 140, 66, 0.05);
      border-color: rgba(255, 140, 66, 0.2);
    }

    /* Effects bar */
    .effects-bar {
      left: 10px;
      top: 690px;
      width: 1180px;
      height: 105px;
      background: rgba(78, 205, 196, 0.05);
      border-color: rgba(78, 205, 196, 0.2);
    }

    /* Control styling */
    button {
      padding: 4px 12px;
      background: #333;
      border: 1px solid #555;
      border-radius: 3px;
      color: #fff;
      cursor: pointer;
      font-size: 11px;
    }

    button:hover {
      background: #444;
    }

    select {
      padding: 4px 8px;
      background: #2a2a2a;
      border: 1px solid #555;
      border-radius: 3px;
      color: #fff;
      font-size: 11px;
      cursor: pointer;
    }

    input[type="range"] {
      -webkit-appearance: none;
      background: transparent;
      cursor: pointer;
    }

    input[type="range"]::-webkit-slider-track {
      background: #333;
      height: 4px;
      border-radius: 2px;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 14px;
      height: 14px;
      background: #4ecdc4;
      border-radius: 50%;
      margin-top: -5px;
    }

    input[type="checkbox"] {
      width: 30px;
      height: 20px;
      cursor: pointer;
    }

    /* Canvas displays */
    canvas {
      border-radius: 3px;
      background: #0a0a0a;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.5);
    }

    /* Control labels */
    .control-label {
      font-size: 10px;
      color: #999;
      text-align: center;
      margin-top: 3px;
    }

    /* Position absolute controls */
    .positioned-control {
      position: absolute;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
  </style>
</head>
<body>
  <!-- Fixed-size plugin frame -->
  <div class="plugin-frame">
    <div class="container">

      <!-- HEADER -->
      <div class="header">
        <button id="preset_prev">◀</button>
        <select id="preset_name">
          <option>Init Preset</option>
          <option>Bass Monster</option>
          <option>Evolving Pad</option>
          <option>Lead Saw</option>
        </select>
        <button id="preset_next">▶</button>
        <button id="randomize">RANDOMIZE</button>
        <div style="margin-left: auto; display: flex; gap: 5px; align-items: center;">
          <span style="font-size: 11px; color: #999;">MASTER</span>
          <input type="range" id="master_volume" min="0" max="1" step="0.01" value="0.5" style="width: 130px;">
        </div>
      </div>

      <!-- OSCILLATOR A -->
      <div class="section osc-section osc-a">
        <div class="section-label" style="top: -8px; left: 10px; background: #1a1a1a; padding: 0 5px;">OSCILLATOR A</div>
        <canvas id="osc_a_waveform_display" width="140" height="80" style="position: absolute; left: 180px; top: 10px;"></canvas>
        <div style="position: absolute; left: 10px; top: 25px;">
          <select id="osc_a_wavetable">
            <option>Basic</option>
            <option>Analog</option>
            <option>Digital</option>
            <option>Vocal</option>
          </select>
        </div>
        <div class="positioned-control" style="left: 10px; top: 90px;">
          <input type="range" id="osc_a_position" min="0" max="1" step="0.01" value="0" style="width: 50px; transform: rotate(-90deg); transform-origin: center;">
          <div class="control-label">Pos</div>
        </div>
        <div class="positioned-control" style="left: 75px; top: 90px;">
          <input type="range" id="osc_a_level" min="0" max="1" step="0.01" value="1" style="width: 50px; transform: rotate(-90deg); transform-origin: center;">
          <div class="control-label">Lvl</div>
        </div>
        <div class="positioned-control" style="left: 140px; top: 90px;">
          <input type="range" id="osc_a_pan" min="0" max="1" step="0.01" value="0.5" style="width: 50px; transform: rotate(-90deg); transform-origin: center;">
          <div class="control-label">Pan</div>
        </div>
        <div style="position: absolute; left: 10px; top: 160px; display: flex; gap: 10px;">
          <div>
            <select id="osc_a_octave">
              <option>-4</option><option>-3</option><option>-2</option><option>-1</option>
              <option selected>0</option>
              <option>+1</option><option>+2</option><option>+3</option><option>+4</option>
            </select>
            <div class="control-label">Oct</div>
          </div>
        </div>
        <div style="position: absolute; left: 200px; top: 90px;">
          <select id="osc_a_warp_mode">
            <option>Sync</option>
            <option>Bend+</option>
            <option>FM</option>
            <option>AM</option>
            <option>PWM</option>
          </select>
          <div class="control-label">Warp Mode</div>
        </div>
      </div>

      <!-- OSCILLATOR B -->
      <div class="section osc-section osc-b">
        <div class="section-label" style="top: -8px; left: 10px; background: #1a1a1a; padding: 0 5px;">OSCILLATOR B</div>
        <canvas id="osc_b_waveform_display" width="140" height="80" style="position: absolute; left: 180px; top: 10px;"></canvas>
        <div style="position: absolute; left: 10px; top: 25px;">
          <select id="osc_b_wavetable">
            <option>Basic</option>
            <option>Analog</option>
            <option>Digital</option>
            <option>Vocal</option>
          </select>
        </div>
        <div class="positioned-control" style="left: 10px; top: 90px;">
          <input type="range" id="osc_b_position" min="0" max="1" step="0.01" value="0" style="width: 50px; transform: rotate(-90deg); transform-origin: center;">
          <div class="control-label">Pos</div>
        </div>
        <div class="positioned-control" style="left: 75px; top: 90px;">
          <input type="range" id="osc_b_level" min="0" max="1" step="0.01" value="1" style="width: 50px; transform: rotate(-90deg); transform-origin: center;">
          <div class="control-label">Lvl</div>
        </div>
        <div class="positioned-control" style="left: 140px; top: 90px;">
          <input type="range" id="osc_b_pan" min="0" max="1" step="0.01" value="0.5" style="width: 50px; transform: rotate(-90deg); transform-origin: center;">
          <div class="control-label">Pan</div>
        </div>
        <div style="position: absolute; left: 200px; top: 90px;">
          <select id="osc_b_warp_mode">
            <option>Sync</option>
            <option>Bend+</option>
            <option>FM</option>
            <option>AM</option>
            <option>PWM</option>
          </select>
          <div class="control-label">Warp Mode</div>
        </div>
      </div>

      <!-- SUB + NOISE -->
      <div class="section sub-noise">
        <div class="section-label" style="top: -8px; left: 10px; background: #1a1a1a; padding: 0 5px;">SUB + NOISE</div>
        <div style="position: absolute; left: 10px; top: 25px;">
          <select id="sub_shape">
            <option>Sine</option>
            <option>Triangle</option>
            <option>Square</option>
          </select>
          <div class="control-label">Shape</div>
        </div>
        <div style="position: absolute; left: 105px; top: 25px;">
          <select id="noise_type">
            <option>White</option>
            <option>Pink</option>
            <option>Digital</option>
          </select>
          <div class="control-label">Type</div>
        </div>
      </div>

      <!-- FILTER -->
      <div class="section filter-section">
        <div class="section-label" style="top: -8px; left: 10px; background: #1a1a1a; padding: 0 5px;">FILTER</div>
        <canvas id="filter_curve_display" width="50" height="90" style="position: absolute; left: 220px; top: 30px;"></canvas>
        <div style="position: absolute; left: 10px; top: 25px;">
          <select id="filter_type">
            <option>LP 24dB</option>
            <option>LP 12dB</option>
            <option>HP 24dB</option>
            <option>BP 12dB</option>
            <option>Notch</option>
          </select>
          <div class="control-label">Filter Type</div>
        </div>
        <div class="positioned-control" style="left: 20px; top: 70px;">
          <input type="range" id="filter_cutoff" min="0" max="1" step="0.01" value="1" style="width: 70px; transform: rotate(-90deg); transform-origin: center;">
          <div class="control-label">Cutoff</div>
        </div>
        <div class="positioned-control" style="left: 110px; top: 85px;">
          <input type="range" id="filter_resonance" min="0" max="1" step="0.01" value="0" style="width: 40px; transform: rotate(-90deg); transform-origin: center;">
          <div class="control-label">Res</div>
        </div>
        <div class="positioned-control" style="left: 165px; top: 85px;">
          <input type="range" id="filter_drive" min="0" max="1" step="0.01" value="0" style="width: 40px; transform: rotate(-90deg); transform-origin: center;">
          <div class="control-label">Drive</div>
        </div>
      </div>

      <!-- AMP ENVELOPE -->
      <div class="section amp-env">
        <div class="section-label" style="top: -8px; left: 10px; background: #1a1a1a; padding: 0 5px;">AMP ENVELOPE</div>
        <canvas id="amp_adsr_display" width="310" height="80" style="position: absolute; left: 10px; top: 20px;"></canvas>
        <div style="position: absolute; left: 20px; top: 110px; display: flex; gap: 15px;">
          <div>
            <input type="range" id="amp_attack" min="0" max="1" step="0.01" value="0.01" style="width: 50px; transform: rotate(-90deg); transform-origin: center;">
            <div class="control-label">Attack</div>
          </div>
          <div>
            <input type="range" id="amp_decay" min="0" max="1" step="0.01" value="0.1" style="width: 50px; transform: rotate(-90deg); transform-origin: center;">
            <div class="control-label">Decay</div>
          </div>
          <div>
            <input type="range" id="amp_sustain" min="0" max="1" step="0.01" value="1" style="width: 50px; transform: rotate(-90deg); transform-origin: center;">
            <div class="control-label">Sustain</div>
          </div>
          <div>
            <input type="range" id="amp_release" min="0" max="1" step="0.01" value="0.2" style="width: 50px; transform: rotate(-90deg); transform-origin: center;">
            <div class="control-label">Release</div>
          </div>
        </div>
      </div>

      <!-- FILTER ENVELOPE -->
      <div class="section filt-env">
        <div class="section-label" style="top: -8px; left: 10px; background: #1a1a1a; padding: 0 5px;">FILTER ENVELOPE</div>
        <canvas id="filt_adsr_display" width="310" height="80" style="position: absolute; left: 10px; top: 20px;"></canvas>
        <div style="position: absolute; left: 20px; top: 110px; display: flex; gap: 15px;">
          <div>
            <input type="range" id="filt_attack" min="0" max="1" step="0.01" value="0.01" style="width: 50px; transform: rotate(-90deg); transform-origin: center;">
            <div class="control-label">Attack</div>
          </div>
          <div>
            <input type="range" id="filt_decay" min="0" max="1" step="0.01" value="0.1" style="width: 50px; transform: rotate(-90deg); transform-origin: center;">
            <div class="control-label">Decay</div>
          </div>
          <div>
            <input type="range" id="filt_sustain" min="0" max="1" step="0.01" value="0.5" style="width: 50px; transform: rotate(-90deg); transform-origin: center;">
            <div class="control-label">Sustain</div>
          </div>
          <div>
            <input type="range" id="filt_release" min="0" max="1" step="0.01" value="0.2" style="width: 50px; transform: rotate(-90deg); transform-origin: center;">
            <div class="control-label">Release</div>
          </div>
        </div>
      </div>

      <!-- LFOs -->
      <div class="section lfo-section">
        <div class="section-label" style="top: -8px; left: 10px; background: #1a1a1a; padding: 0 5px;">LFOS</div>
        <div style="display: flex; gap: 20px; padding: 10px;">
          <div>
            <div style="display: flex; gap: 5px; align-items: center;">
              <select id="lfo1_shape">
                <option>Sine</option>
                <option>Triangle</option>
                <option>Saw</option>
                <option>Square</option>
                <option>S&H</option>
              </select>
              <canvas id="lfo1_waveform_preview" width="50" height="30"></canvas>
            </div>
            <input type="checkbox" id="lfo1_sync">
            <div class="control-label">LFO1</div>
          </div>
          <div>
            <div style="display: flex; gap: 5px; align-items: center;">
              <select id="lfo2_shape">
                <option>Sine</option>
                <option>Triangle</option>
                <option>Saw</option>
                <option>Square</option>
                <option>S&H</option>
              </select>
              <canvas id="lfo2_waveform_preview" width="50" height="30"></canvas>
            </div>
            <input type="checkbox" id="lfo2_sync">
            <div class="control-label">LFO2</div>
          </div>
          <div>
            <div style="display: flex; gap: 5px; align-items: center;">
              <select id="lfo3_shape">
                <option>Sine</option>
                <option>Triangle</option>
                <option>Saw</option>
                <option>Square</option>
                <option>S&H</option>
              </select>
              <canvas id="lfo3_waveform_preview" width="50" height="30"></canvas>
            </div>
            <input type="checkbox" id="lfo3_sync">
            <div class="control-label">LFO3</div>
          </div>
          <div>
            <div style="display: flex; gap: 5px; align-items: center;">
              <select id="lfo4_shape">
                <option>Sine</option>
                <option>Triangle</option>
                <option>Saw</option>
                <option>Square</option>
                <option>S&H</option>
              </select>
              <canvas id="lfo4_waveform_preview" width="50" height="30"></canvas>
            </div>
            <input type="checkbox" id="lfo4_sync">
            <div class="control-label">LFO4</div>
          </div>
        </div>
      </div>

      <!-- MACROS + VOICE -->
      <div class="section macros-voice">
        <div class="section-label" style="top: -8px; left: 10px; background: #1a1a1a; padding: 0 5px;">MACROS + VOICE</div>
        <div style="display: flex; gap: 20px; padding: 15px;">
          <div>
            <input type="range" id="macro1" min="0" max="1" step="0.01" value="0.5" style="width: 55px; transform: rotate(-90deg); transform-origin: center;">
            <div class="control-label">M1</div>
          </div>
          <div>
            <input type="range" id="macro2" min="0" max="1" step="0.01" value="0.5" style="width: 55px; transform: rotate(-90deg); transform-origin: center;">
            <div class="control-label">M2</div>
          </div>
          <div>
            <input type="range" id="macro3" min="0" max="1" step="0.01" value="0.5" style="width: 55px; transform: rotate(-90deg); transform-origin: center;">
            <div class="control-label">M3</div>
          </div>
          <div>
            <input type="range" id="macro4" min="0" max="1" step="0.01" value="0.5" style="width: 55px; transform: rotate(-90deg); transform-origin: center;">
            <div class="control-label">M4</div>
          </div>
          <div style="margin-left: 20px;">
            <select id="unison_voices">
              <option>1</option>
              <option>2</option>
              <option>4</option>
              <option>8</option>
              <option>16</option>
            </select>
            <div class="control-label">Voices</div>
          </div>
        </div>
      </div>

      <!-- EFFECTS BAR -->
      <div class="section effects-bar">
        <div class="section-label" style="top: -8px; left: 10px; background: #1a1a1a; padding: 0 5px;">EFFECTS</div>
        <div style="display: flex; gap: 30px; padding: 20px; justify-content: space-around;">
          <div><input type="range" id="fx_distortion_mix" min="0" max="1" step="0.01" value="0" style="width: 30px; transform: rotate(-90deg);"><div class="control-label">Dist</div></div>
          <div><input type="range" id="fx_chorus_mix" min="0" max="1" step="0.01" value="0" style="width: 30px; transform: rotate(-90deg);"><div class="control-label">Chorus</div></div>
          <div><input type="range" id="fx_phaser_mix" min="0" max="1" step="0.01" value="0" style="width: 30px; transform: rotate(-90deg);"><div class="control-label">Phaser</div></div>
          <div><input type="range" id="fx_flanger_mix" min="0" max="1" step="0.01" value="0" style="width: 30px; transform: rotate(-90deg);"><div class="control-label">Flanger</div></div>
          <div><input type="range" id="fx_delay_mix" min="0" max="1" step="0.01" value="0" style="width: 30px; transform: rotate(-90deg);"><div class="control-label">Delay</div></div>
          <div><input type="range" id="fx_reverb_mix" min="0" max="1" step="0.01" value="0" style="width: 30px; transform: rotate(-90deg);"><div class="control-label">Reverb</div></div>
          <div><input type="range" id="fx_eq_mix" min="0" max="1" step="0.01" value="0" style="width: 30px; transform: rotate(-90deg);"><div class="control-label">EQ</div></div>
          <div><input type="range" id="fx_compressor_mix" min="0" max="1" step="0.01" value="0" style="width: 30px; transform: rotate(-90deg);"><div class="control-label">Comp</div></div>
        </div>
      </div>

    </div>
  </div>

  <script type="module">
    // JUCE FRONTEND LIBRARY IMPORT
    import * as Juce from "./js/juce/index.js";

    // NATIVE APPLICATION FEEL
    document.addEventListener("contextmenu", (e) => {
      e.preventDefault();
      return false;
    });

    document.addEventListener("dragstart", (e) => {
      e.preventDefault();
    });

    // ERROR HANDLING
    window.addEventListener("error", (e) => {
      console.error("JavaScript error:", e.message, e.filename, e.lineno);
    });

    window.addEventListener("unhandledrejection", (e) => {
      console.error("Unhandled promise rejection:", e.reason);
    });

    // VERIFY JUCE BACKEND
    if (!window.__JUCE__) {
      console.error("JUCE backend not available");
      document.body.innerHTML = "<h1>Error: JUCE backend not connected</h1>";
      throw new Error("JUCE backend not connected");
    }

    console.log("JUCE backend connected:", window.__JUCE__.backend);

    // PARAMETER BINDINGS
    // NOTE: Full parameter binding implementation will be added during Stage 3 integration
    // This file serves as the production HTML template

    console.log("Codox UI initialized - 50 parameters ready for binding");
  </script>
</body>
</html>
